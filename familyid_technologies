import pandas as pd

# Liste der Dateien
files = [
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1907.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1908.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1908-2.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1909.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1910.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1911.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1911-2.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1912.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1912-2.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1913.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1914.csv',
    '/Users/janniskerl/Downloads/Espacenet-Suchergebnis_20241001_1914-2.csv'
]

# Liste für alle DataFrames
dfs = []

# Gewünschte Spalten
columns = ['No', 'IPC', 'CPC', 'Früheste Priorität', 'Familiennummer']

for file in files:
    # Einlesen der CSV-Dateien (Beachte die Trennung durch "")
    df = pd.read_csv(file, header=7, sep=';', quotechar='"')
    
    # Nur die relevanten Spalten extrahieren
    df_subset = df[['No', 'IPC', 'CPC', 'Früheste Priorität', 'Familiennummer']]
    
    # Jahr der frühesten Priorität extrahieren
    df_subset['Früheste Priorität'] = pd.to_datetime(df_subset['Früheste Priorität'], errors='coerce').dt.year
    
    # DataFrame zur Liste hinzufügen
    dfs.append(df_subset)

# Alle DataFrames zusammenfügen
merged_df = pd.concat(dfs, ignore_index=True)

# Duplikate basierend auf der Familiennummer entfernen
cleaned_df = merged_df.drop_duplicates(subset=['Familiennummer'])
print(len(cleaned_df['Familiennummer'].unique()))
# Ergebnis als CSV speichern
cleaned_df.to_csv('/Users/janniskerl/LithiumNickelCobaltOxide_data.csv', index=False)

print("Die Daten wurden erfolgreich zusammengeführt und bereinigt!")
